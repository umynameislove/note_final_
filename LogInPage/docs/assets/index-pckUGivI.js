(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const t of s.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&n(t)}).observe(document,{childList:!0,subtree:!0});function i(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(e){if(e.ep)return;e.ep=!0;const s=i(e);fetch(e.href,s)}})();document.getElementById("log-in-button");const g=document.getElementById("log-in-form"),l=document.getElementById("log-in-email"),p=document.getElementById("log-in-password");function d(){let r=!0;return l.value.trim()?isEmailValid(l.value.trim())?showError("log-in-email-error","log-in-email-error-icon","",!0,""):(showError("log-in-email-error","log-in-email-error-icon","Email is invalid.",!1,"log-in-email-shake"),r=!1):(showError("log-in-email-error","log-in-email-error-icon","Email is required.",!1,"log-in-email-shake"),r=!1),p.value===""?(showError("log-in-password-error","log-in-password-error-icon","Password is required.",!1,"log-in-password-shake"),r=!1):showError("log-in-password-error","log-in-password-error-icon","Password is wrong",!0,""),r}g.addEventListener("submit",r=>{r.preventDefault(),d()==!0&&f()});async function f(){const r=document.getElementById("log-in-email").value,o=document.getElementById("log-in-password").value,i=document.getElementById("error-msg");if(!d()){console.log("Wrong Input");return}try{const n=await fetch("http://localhost:4000/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,password:o})}),e=await n.json();n.ok?(localStorage.setItem("user",JSON.stringify({_id:e.user._id,email:e.user.email,username:e.user.username,role:e.user.role})),showToast("Login Success!",1e3),setTimeout(()=>{window.location.href="../notes/notes.html"},3e3)):(i.innerText=e.message,i.classList.remove("hidden"))}catch(n){i.innerText="Server error",i.classList.remove("hidden"),console.error("Login error:",n)}}document.getElementById("sign-up-button");const h=document.getElementById("sign-up-form"),u=document.getElementById("sign-up-name"),m=document.getElementById("sign-up-email"),a=document.getElementById("sign-up-password"),c=document.getElementById("sign-up-confirm-password");async function w(){let r=!0;u.value.trim()===""?(showError("sign-up-name-error","sign-up-name-error-icon","Username is required.",!1,"sign-up-name-shake"),r=!1):showError("sign-up-name-error","sign-up-name-error-icon","",!0,"");const o=m.value.trim();return o?isEmailValid(o)?await E(o)?(showError("sign-up-email-error","sign-up-email-error-icon","Email already exists.",!1,"sign-up-email-shake"),r=!1):showError("sign-up-email-error","sign-up-email-error-icon","",!0,""):(showError("sign-up-email-error","sign-up-email-error-icon","Email is invalid.",!1,"sign-up-email-shake"),r=!1):(showError("sign-up-email-error","sign-up-email-error-icon","Email is required.",!1,"sign-up-email-shake"),r=!1),a.value?showError("sign-up-password-error","sign-up-password-error-icon","",!0,""):(showError("sign-up-password-error","sign-up-password-error-icon","Password is required.",!1,"sign-up-password-shake"),r=!1),c.value?c.value!==a.value?(showError("sign-up-confirm-password-error","sign-up-confirm-password-error-icon","Confirm password does not match.",!1,"sign-up-confirm-password-shake"),r=!1):showError("sign-up-confirm-password-error","sign-up-confirm-password-error-icon","",!0,""):(showError("sign-up-confirm-password-error","sign-up-confirm-password-error-icon","Confirm password is required.",!1,"sign-up-confirm-password-shake"),r=!1),r}async function E(r){try{return(await(await fetch(`http://localhost:4000/api/auth/check-email?email=${encodeURIComponent(r)}`)).json()).exists}catch(o){return console.error("Error checking email:",o),!1}}h.addEventListener("submit",async r=>{r.preventDefault(),await w()&&y()});async function y(){const r=u.value,o=a.value,i=m.value,n=document.getElementById("error-msg");try{const e=await fetch("http://localhost:4000/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,email:i,password:o})}),s=await e.json();e.ok?(showToast("Register Success!",3e3),setTimeout(()=>{window.location.href="./index.html"},3e3)):(n.innerText=s.message,n.classList.remove("hidden"))}catch(e){n.innerText="Server error",n.classList.remove("hidden"),console.error("Register error:",e)}}document.getElementById("sign-up-button").addEventListener("click",function(){document.getElementById("login-container").classList.add("hidden"),document.getElementById("signup-container").classList.remove("hidden")});document.getElementById("log-in-button").addEventListener("click",function(){document.getElementById("login-container").classList.remove("hidden"),document.getElementById("signup-container").classList.add("hidden")});
